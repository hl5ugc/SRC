/* --------------------------------------------------------------------------
 * [ PROJECT   ]
 * [ License   ]  SAMJIN ELECTRONICS.,Co.Ltd
 * [ Author    ]  Copyright 2023 By HAG-SEONG KANG
 * [ E-MAIL    ]  hl5ugc@nate.com (82)10- 3841-9706
 * [ C  P  U   ]
 * [ Compller  ]
 * [ Filename  ]  IPL_PULSE.c
 * [ Version   ]  1.0
 * [ Created   ]
 * --------------------------------------------------------------------------
 * Revision History :
 * ------------------------------------------------------------------
 *
 *
 *  *.The use of this source code shall be deemed to have been
 *    tacitly agreed by the user.
 *  *.This source code is freely available for personal learning
 *    and research and development.
 *  *.In the case of secondary authoring or redistribution using this source,
 *    it is essential The company name of SAMJIN ELECTRONICS must be specified.
 *  *.Do not sell or for-profit this source code.
 *	*.This clause and the original author mark are prohibited from being
 *	  modified or deleted.
 *
 *------------------------------------------------------------------
 * --------------------------------------------------------------------------
 * Author         Date       Comments on this revision
 * --------------------------------------------------------------------------
 * Hagseong Kang  Jul 14, 2023    First release of this file
 * --------------------------------------------------------------------------
 * Additional Notes:
 * **************************************************************************
 */
 /**
 * @brief
 * @param
 * @return
 */

#pragma used+
/* Define Includes */
#include "IPL_PULSE.h"
 
 
// ---------------------------------------------------------------------------
//  Define Macros .
// ---------------------------------------------------------------------------
//
 
// ---------------------------------------------------------------------------
//  Define Constants.
// ---------------------------------------------------------------------------
//
// Duration time ... Pulse time (mSec X 10)
const uint16_t Pulse_1_data_tbl[]  =  { 30, 40, 50, 60, 70, 80, 90,100,110,120,
                                       130,140,150,160,170,180,190,200,210,220,
                                       230,240,250,260,270,280,290,300}; 
//                                  /
const uint16_t Pulse_3_data_tbl[12][6]  = {{12, 20, 20, 30, 20, 30} ,{14, 20, 20, 40, 20, 40} ,
                                      {16, 30, 30, 30, 30, 40} ,{18, 30, 30, 40, 30, 50} , 
                                      {20, 40, 40, 40, 40, 40} ,{22, 40, 40, 50, 40, 50} ,
                                      {24, 40, 50, 50, 50, 50} ,{26, 50, 50, 50, 50, 60} ,
                                      {28, 60, 50, 50, 50, 60} ,{30, 40, 30, 90, 40,100} ,
                                      {35, 50, 40,100, 40,120} ,{40, 50, 50,120, 50,130} }; 
//                                           
//   2018.03.08                                  
const uint16_t Pulse_7_data_tbl[12][14] =  {{13,10,20, 5,20, 5,20, 5,10, 5,10, 5,10, 5} ,
                                        {15,10,20,10,20,10,20, 5,20, 5,10, 5,10, 5} ,
                                        {16,10,20,10,20,10,20,10,20,10,10, 5,10, 5} ,
                                        {18,12,30,12,20,12,20,12,20,10,10, 8,10, 5} , 
                                        {20,12,30,12,30,12,20,12,20,12,10,10,10,10} ,
                                        {22,15,40,12,30,12,20,12,20,12,10,12,10,10} ,
                                        {24,15,40,15,30,15,30,15,20,12,20,12,10,10} ,                                       
                                        {26,18,40,18,30,15,30,15,30,12,20,10,10,10} ,
                                        {28,18,40,18,40,15,30,15,30,15,30,10,10,10} ,
                                        {30,20,50,20,50,18,30,15,30,15,30,10,10,10} ,  
                                        {35,25,50,20,50,20,40,18,40,15,40,15,10,10} ,
                                        {40,30,50,25,50,20,50,18,40,18,30,15,30,15} } ;                                        
//                               
const uint16_t Pulse_I_data_tbl[80]  =     { 5,10, 5,10, 5,10, 5,10, 5,10, 5,10, 5,10, 5,10, 5,10, 5,10,
                                         6,10, 6,10, 6,10, 6,10, 6,10, 6,10, 6,10, 6,10, 6,10, 6,10,
                                         8,10, 8,10, 8,10, 8,10, 8,10, 8,10, 8,10, 8,10, 8,10, 8,10,
                                        10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10} ; 
//                                       
// fluence Define ....
//
/*
const uint16_t Pulse_1_flu_tbl[31] = {
     20, 30, 40, 50, 60, 70, 80, 90,100,110,
    120,130,140,150,160,170,180,190,200,210,
    220,230,240,250,260,270,280,290,300,310,
    320};
const uint16_t Pulse_3_flu_tbl1[31] = {
 20,30,40,50,60,70,80,90,100,110,120,130,140,150,160,170,180,190,200,210,220,230,240,250,260,270,280,290,300,310,320};
const uint16_t Pulse_3_flu_tbl2[31] = {
 25,35,45,55,65,75,85,95,105,115,125,135,145,155,165,175,185,195,205,215,225,235,245,255,265,275,285,295,305,315,325};
const uint16_t Pulse_3_flu_tbl3[31] = {
 30,40,50,60,70,80,90,100,110,120,130,140,150,160,170,180,190,200,210,220,230,240,250,260,270,280,290,300,310,320,330};
const uint16_t Pulse_3_flu_tbl4[31] = {
 35,45,55,65,75,85,95,105,115,125,135,145,155,165,175,185,195,205,215,225,235,245,255,265,275,285,295,305,315,325,335};
const uint16_t Pulse_3_flu_tbl5[31] = {
 40,50,60,70,80,90,100,110,120,130,140,150,160,170,180,190,200,210,220,230,240,250,260,270,280,290,300,310,320,330,340};
const uint16_t Pulse_3_flu_tbl6[31] = {
 45,55,65,75,85,95,105,115,125,135,145,155,165,175,185,195,205,215,225,235,245,255,265,275,285,295,305,315,325,335,345};
const uint16_t Pulse_3_flu_tbl7[31] = {
 50,60,70,80,90,100,110,120,130,140,150,160,170,180,190,200,210,220,230,240,250,260,270,280,290,300,310,320,330,340,350};
const uint16_t Pulse_3_flu_tbl8[31] = {
 55,65,75,85,95,105,115,125,135,145,155,165,175,185,195,205,215,225,235,245,255,265,275,285,295,305,315,325,335,345,355};
const uint16_t Pulse_3_flu_tbl9[31] = {
 60,70,80,90,100,110,120,130,140,150,160,170,180,190,200,210,220,230,240,250,260,270,280,290,300,310,320,330,340,350,360};
const uint16_t Pulse_3_flu_tbl10[31] = {
 65,75,85,95,105,115,125,135,145,155,165,175,185,195,205,215,225,235,245,255,265,275,285,295,305,315,325,335,345,355,365};
const uint16_t Pulse_3_flu_tbl11[31] = {
 77,87,97,107,117,127,137,147,157,167,177,187,197,207,217,227,237,247,257,267,277,287,297,307,317,327,337,347,357,367,377};
const uint16_t Pulse_3_flu_tbl12[31] = {
 89,99,109,119,129,139,149,159,169,179,189,199,209,219,229,239,249,259,269,279,289,299,309,319,329,339,349,359,369,379,389}; 
 
const uint16_t Pulse_3_flu_tbl[12][31] = {
{20,30,40,50,60,70,80,90,100,110,120,130,140,150,160,170,180,190,200,210,220,230,240,250,260,270,280,290,300,310,320},
{25,35,45,55,65,75,85,95,105,115,125,135,145,155,165,175,185,195,205,215,225,235,245,255,265,275,285,295,305,315,325},
{30,40,50,60,70,80,90,100,110,120,130,140,150,160,170,180,190,200,210,220,230,240,250,260,270,280,290,300,310,320,330},
{35,45,55,65,75,85,95,105,115,125,135,145,155,165,175,185,195,205,215,225,235,245,255,265,275,285,295,305,315,325,335},
{40,50,60,70,80,90,100,110,120,130,140,150,160,170,180,190,200,210,220,230,240,250,260,270,280,290,300,310,320,330,340},
{45,55,65,75,85,95,105,115,125,135,145,155,165,175,185,195,205,215,225,235,245,255,265,275,285,295,305,315,325,335,345},
{50,60,70,80,90,100,110,120,130,140,150,160,170,180,190,200,210,220,230,240,250,260,270,280,290,300,310,320,330,340,350},
{55,65,75,85,95,105,115,125,135,145,155,165,175,185,195,205,215,225,235,245,255,265,275,285,295,305,315,325,335,345,355},
{60,70,80,90,100,110,120,130,140,150,160,170,180,190,200,210,220,230,240,250,260,270,280,290,300,310,320,330,340,350,360},
{65,75,85,95,105,115,125,135,145,155,165,175,185,195,205,215,225,235,245,255,265,275,285,295,305,315,325,335,345,355,365},
{77,87,97,107,117,127,137,147,157,167,177,187,197,207,217,227,237,247,257,267,277,287,297,307,317,327,337,347,357,367,377},
{89,99,109,119,129,139,149,159,169,179,189,199,209,219,229,239,249,259,269,279,289,299,309,319,329,339,349,359,369,379,389}};

//
const uint16_t Pulse_7_flu_tbl[12][31] = {
{20,30,40,50,60,70,80,90,100,110,120,130,140,150,160,170,180,190,200,210,220,230,240,250,260,270,280,290,300,310,320},
{25,35,45,55,65,75,85,95,105,115,125,135,145,155,165,175,185,195,205,215,225,235,245,255,265,275,285,295,305,315,325},
{30,40,50,60,70,80,90,100,110,120,130,140,150,160,170,180,190,200,210,220,230,240,250,260,270,280,290,300,310,320,330},
{35,45,55,65,75,85,95,105,115,125,135,145,155,165,175,185,195,205,215,225,235,245,255,265,275,285,295,305,315,325,335},
{40,50,60,70,80,90,100,110,120,130,140,150,160,170,180,190,200,210,220,230,240,250,260,270,280,290,300,310,320,330,340},
{45,55,65,75,85,95,105,115,125,135,145,155,165,175,185,195,205,215,225,235,245,255,265,275,285,295,305,315,325,335,345},
{50,60,70,80,90,100,110,120,130,140,150,160,170,180,190,200,210,220,230,240,250,260,270,280,290,300,310,320,330,340,350},
{55,65,75,85,95,105,115,125,135,145,155,165,175,185,195,205,215,225,235,245,255,265,275,285,295,305,315,325,335,345,355},
{60,70,80,90,100,110,120,130,140,150,160,170,180,190,200,210,220,230,240,250,260,270,280,290,300,310,320,330,340,350,360},
{65,75,85,95,105,115,125,135,145,155,165,175,185,195,205,215,225,235,245,255,265,275,285,295,305,315,325,335,345,355,365},
{77,87,97,107,117,127,137,147,157,167,177,187,197,207,217,227,237,247,257,267,277,287,297,307,317,327,337,347,357,367,377},
{89,99,109,119,129,139,149,159,169,179,189,199,209,219,229,239,249,259,269,279,289,299,309,319,329,339,349,359,369,379,389}};
 
const uint16_t Pulse_I_flu_tbl[31] = {
   89, 99,109,119,129,139,149,159,169,179,
  189,199,209,219,229,239,249,259,269,279,
  289,299,309,319,329,339,349,359,369,379,
  389};   
*/
// ---------------------------------------------------------------------------
// Define typedef.
// --------------------------------------------------------------------------- 
// 
SYSTEM_FLAG IPL_pulse_flag ;

// ---------------------------------------------------------------------------
//  Define Global variables.
// ---------------------------------------------------------------------------
//
 
uint16_t    Pulse_i_data[81]   ;
uint8_t     Pulse_data_ptr = 0U ;
// ---------------------------------------------------------------------------
//  Define Private variables.
// ---------------------------------------------------------------------------
//
 

 
// ---------------------------------------------------------------------------
//  Define Varibales Macro.
// ---------------------------------------------------------------------------
 
// ---------------------------------------------------------------------------
// Define private function definitions.
// ---------------------------------------------------------------------------
//
 
// ---------------------------------------------------------------------------
// Define Public function definitions.
// ---------------------------------------------------------------------------
//
void IplPulseInit(void)
{
 
}
/**
 * @brief 
 * 
 * @param u16Ipulse_Type 
 * @param u16Dur 
 * @param u16Level 
 * @return uint16_t E_FLUENCE_VALUE
 */
uint16_t Level_to_Flu_cal(uint16_t u16Ipulse_Type,uint16_t u16Dur,uint16_t u16Level)
{
  uint16_t u16Ret = 0U ;
  u16Ret = u16Level;
  PARAM_UNUSED(u16Ipulse_Type);
  PARAM_UNUSED(u16Dur);
  /*
  u16Level-- ;
  switch(u16Ipulse_Type)
  {
    case 0x01:
      u16Ret = Pulse_1_flu_tbl[u16Level-1] ;
      break ;
    case 0x02:
      switch(u16Dur)
      {
        case 0:     
                u16Ret = Pulse_3_flu_tbl1[u16Level-1]  ; 
                break ;
        case 1:     
                u16Ret = Pulse_3_flu_tbl2[u16Level-1]  ; 
                break ;           
        case 2:     
                u16Ret = Pulse_3_flu_tbl3[u16Level-1]  ; 
                break ;
        case 3:     
                u16Ret = Pulse_3_flu_tbl4[u16Level-1]  ; 
                break ; 
        case 4:     
                u16Ret = Pulse_3_flu_tbl5[u16Level-1]  ; 
                break ;
        case 5:     
                u16Ret = Pulse_3_flu_tbl6[u16Level-1]  ; 
                break ; 
        case 6:     
                u16Ret = Pulse_3_flu_tbl7[u16Level-1]  ; 
                break ;
        case 7:     
                u16Ret = Pulse_3_flu_tbl8[u16Level-1]  ; 
                break ;           
        case 8:     
                u16Ret = Pulse_3_flu_tbl9[u16Level-1]  ; 
                break ;
        case 9:     
                u16Ret = Pulse_3_flu_tbl10[u16Level-1]  ; 
                break ; 
        case 10:     
                u16Ret = Pulse_3_flu_tbl11[u16Level-1]  ; 
                break ;
        case 11:     
                u16Ret = Pulse_3_flu_tbl12[u16Level-1]  ; 
                break ;            
                    }
      break ; 
    case 3 :    //    
                //E_FLUENCE_VALUE = Pulse_7_flu_tbl[i_dur][u16Level-1]  ; 
                break ; 
    case 4 :    //    
                //Pulse_1_flu_ptr = &Pulse_I_flu_tbl[0] ;
                //E_FLUENCE_VALUE = *(Pulse_1_flu_ptr + u16Level)  ; 
                u16Ret = Pulse_I_flu_tbl[u16Level-1]  ; 
                break ; 
  }
  */
  return (u16Ret);
}
/**
 * @brief get Duration Value
 * 
 * @param u16Ipulse_type 
 * @param u16Dur 
 * @return uint16_t  DURATION_VALUE
 */
uint16_t dur_data_load(uint16_t u16Ipulse_Type,uint8_t u16Dur)
{
  uint16_t u16Ret = 0U ;
  uint8_t  u8i = 0U; 
  //
  switch(u16Ipulse_Type) 
  {
      case 1 :    //    
                  u16Ret = Pulse_1_data_tbl[u16Dur] / 10 ; 
                  Pulse_i_data[0] =  Pulse_1_data_tbl[u16Dur]  ;
                  Pulse_i_data[1] = 0x00 ;
                  break ;  
      case 2 :    // 
                  //load_Pulse_3_data_tbl(i_dur);
                  //   
                  u16Ret = Pulse_3_data_tbl[u16Dur][0] ;
                  Pulse_i_data[0] =  Pulse_3_data_tbl[u16Dur][1] ; 
                  Pulse_i_data[1] =  Pulse_3_data_tbl[u16Dur][2] ;
                  Pulse_i_data[2] =  Pulse_3_data_tbl[u16Dur][3] ;
                  Pulse_i_data[3] =  Pulse_3_data_tbl[u16Dur][4] ;
                  Pulse_i_data[4] =  Pulse_3_data_tbl[u16Dur][5] ;
                  Pulse_i_data[5] = 0x00 ;
                  //
                  break ; 
      case 3 :    //    7 pluse imsi 5   
                  //load_Pulse_7_data_tbl(i_dur);
                  //
                  u16Ret = Pulse_7_data_tbl[u16Dur][0] ; 
                  for(u8i=0; u8i<13; u8i++) { 
                      Pulse_i_data[u8i] = Pulse_7_data_tbl[u16Dur][u8i+1] ; 
                  }
                  Pulse_i_data[13] = 0x00 ; 
                  //
                  break ; 
      case 4 :    //    
                  u16Ret = 68U ;
                  for(u8i=0; u8i<80; u8i++) { 
                      Pulse_i_data[u8i] =  Pulse_I_data_tbl[u8i] ; 
                  }
                  Pulse_i_data[80] =  0x00 ; 
                  //
                  break ; 
  }  

  return (u16Ret);
}
void dur_ptr_limit_check(uint16_t u16Ipulse_Type,uint8_t u8Updown,uint8_t *pDurPtr)
{
  uint8_t u8Max = 0U ;
  uint8_t u8Min = 0U ; 

  switch (u16Ipulse_Type)
  {
    case 0x01U :
      u8Max = Pulse_1_DUR_MAX ;
      u8Min = Pulse_1_DUR_MIN ;
      break;
    case 0x02U :
      u8Max = Pulse_3_DUR_MAX ;
      u8Min = Pulse_3_DUR_MIN ;
      break;
    case 0x03U :
      u8Max = Pulse_7_DUR_MAX ;
      u8Min = Pulse_7_DUR_MIN ;
      break;
    case 0x04U :
      u8Max = Pulse_I_DUR_MAX ;
      u8Min = Pulse_I_DUR_MIN ;
      break;
  }
  //
  if(u8Max > 0U)
  {
    if((u8Updown == 'u') || (u8Updown == 'U'))
    {
       pDurPtr[0]++ ;
      if(pDurPtr[0] > u8Max) { pDurPtr[0] = u8Max;}
    }
    else
    {
      if(pDurPtr[0] > u8Min) { pDurPtr[0]-- ; }
      else { pDurPtr[0] = u8Min ; }
    }
  }
}
// ---------------------------------------------------------------------------
// Define Private function prototype.
// ---------------------------------------------------------------------------
//

// ---------------------------------------------------------------------------
//  Define Callbacks definitions.
// ---------------------------------------------------------------------------
//
 

#pragma used-  /* IPL_PULSE.c End Of File !! Well Done */